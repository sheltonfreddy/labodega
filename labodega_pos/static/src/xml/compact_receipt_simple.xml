<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- Compact 80mm Receipt - Grocery style (Walmart/Kroger-ish) -->
    <t t-name="labodega_pos.CompactOrderReceipt" owl="1">
        <div class="pos-receipt compact-receipt compact80">

            <!-- ===== HEADER ===== -->
            <div class="h1" t-esc="props.data.headerData.company.name"/>
            <div class="h2">
                <t t-if="props.data.headerData.company.street">
                    <span t-esc="props.data.headerData.company.street"/>
                </t>
                <t t-if="props.data.headerData.company.city">
                    <span t-if="props.data.headerData.company.street">, </span>
                    <span t-esc="props.data.headerData.company.city"/>
                </t>
                <t t-if="props.data.headerData.company.phone">
                    <span> â€¢ </span><span t-esc="props.data.headerData.company.phone"/>
                </t>
            </div>

            <div class="meta">
                <div class="meta-row">
                    <span class="meta-lbl">Order</span>
                    <span class="meta-val" t-esc="props.data.name"/>
                </div>
                <div class="meta-row">
                    <!-- date can be formatted object or string depending on build -->
                    <span class="meta-val" t-esc="props.data.date?.formatted or props.data.date"/>
                </div>
                <t t-if="props.data.cashier">
                    <div class="meta-row">
                        <span class="meta-lbl">Cashier</span>
                        <span class="meta-val" t-esc="props.data.cashier"/>
                    </div>
                </t>
            </div>

            <div class="sep">------------------------------------------</div>

            <!-- ===== ORDER LINES ===== -->
            <div class="lines">
                <t t-foreach="props.data.orderlines or []" t-as="l" t-key="l.uuid">

                    <!-- Main item row -->
                    <div class="row item">
                        <div class="left">
                            <span class="name" t-esc="l.product_name"/>
                            <t t-if="l.quantity != 1">
                                <span class="qty"> x<t t-esc="l.quantity"/></span>
                            </t>
                        </div>
                        <div class="right">
                            <!-- prefer price_with_tax if present, else fallback -->
                            <t t-esc="l.price_with_tax or l.price_display or props.formatCurrency(l.price)"/>
                        </div>
                    </div>

                    <!-- Subline ONLY when qty > 1 (Option B) -->
                    <t t-if="l.quantity != 1">
                        <div class="sub">
                            <span t-esc="l.quantity"/> @
                            <span t-esc="l.price_unit_display or props.formatCurrency(l.price_unit)"/>
                        </div>
                    </t>

                    <!-- Customer note (only if present, tight) -->
                    <t t-if="l.customerNote">
                        <div class="note">NOTE: <t t-esc="l.customerNote"/></div>
                    </t>

                </t>
            </div>

            <div class="sep">------------------------------------------</div>

            <!-- ===== TOTALS ===== -->
            <div class="totals">
                <div class="row">
                    <div class="left">Subtotal</div>
                    <div class="right" t-esc="props.data.total_without_tax"/>
                </div>

                <!-- Taxes: keep compact. If you want ONLY one Tax line, see the note below -->
                <t t-if="props.data.taxTotals and props.data.taxTotals.has_tax_groups">
                    <t t-foreach="props.data.taxTotals.subtotals" t-as="st" t-key="st.name">
                        <t t-foreach="st.tax_groups" t-as="tg" t-key="tg.id">
                            <div class="row">
                                <div class="left">Tax</div>
                                <div class="right" t-esc="props.formatCurrency(tg.tax_amount_currency)"/>
                            </div>
                        </t>
                    </t>
                </t>

                <div class="sep thin">------------------------------------------</div>

                <div class="row grand">
                    <div class="left">TOTAL</div>
                    <div class="right" t-esc="props.data.total_with_tax"/>
                </div>

                <!-- Rounding (if enabled) -->
                <t t-if="props.data.show_rounding">
                    <div class="row">
                        <div class="left"><t t-esc="props.data.label_rounding"/></div>
                        <div class="right" t-esc="props.formatCurrency(props.data.taxTotals.order_sign * props.data.taxTotals.order_rounding)"/>
                    </div>
                    <div class="row">
                        <div class="left">To Pay</div>
                        <div class="right" t-esc="props.formatCurrency(props.data.taxTotals.order_sign * (props.data.taxTotals.order_total + props.data.taxTotals.order_rounding))"/>
                    </div>
                </t>

                <!-- Payments -->
                <t t-if="props.data.paymentlines?.length">
                    <div class="sep thin">------------------------------------------</div>
                    <t t-foreach="props.data.paymentlines" t-as="p" t-key="p.uuid or p.name">
                        <div class="row">
                            <div class="left" t-esc="p.name"/>
                            <div class="right" t-esc="props.formatCurrency(p.amount)"/>
                        </div>

                        <!-- Payment terminal slip (only if it exists) -->
                        <t t-if="p.ticket">
                            <div class="terminal">
                                <pre t-esc="p.ticket"/>
                            </div>
                        </t>
                    </t>
                </t>

                <t t-if="props.data.show_change">
                    <div class="row">
                        <div class="left"><t t-esc="props.data.label_change"/></div>
                        <div class="right" t-esc="props.formatCurrency(props.data.order_change)"/>
                    </div>
                </t>

                <t t-if="props.data.total_discount">
                    <div class="row savings">
                        <div class="left"><t t-esc="props.data.label_discounts"/></div>
                        <div class="right" t-esc="props.formatCurrency(props.data.total_discount)"/>
                    </div>
                </t>
            </div>

            <!-- ===== FOOTER (tight, no <br/>) ===== -->
            <t t-if="props.data.footer">
                <div class="footer-text" t-esc="props.data.footer"/>
            </t>

            <div class="footer">
                <div class="thanks">THANK YOU!</div>
                <div class="small">Powered by Odoo</div>
            </div>

        </div>
    </t>

</templates>
