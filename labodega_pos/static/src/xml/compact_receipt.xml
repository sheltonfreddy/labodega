<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

  <!-- Inherit and modify the POS receipt template -->
  <t t-name="point_of_sale.OrderReceipt" t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">

    <!-- Replace the main receipt div with compact version -->
    <xpath expr="//div[hasclass('pos-receipt')]" position="replace">
      <div class="pos-receipt compact-receipt compact80">

        <!-- ===== LOGO ONLY (remove duplicate company name) ===== -->
        <div class="text-center logo-section">
          <img t-attf-src="/web/image?model=res.company&amp;id={{props.data.headerData.company.id}}&amp;field=logo" alt="Logo" class="pos-receipt-logo compact-logo"/>
        </div>

        <!-- ===== HEADER (company info without name) ===== -->
        <div class="h2 company-info">
          <t t-if="props.data.headerData.company.street">
            <div t-esc="props.data.headerData.company.street"/>
          </t>
          <t t-if="props.data.headerData.company.city">
            <div t-esc="props.data.headerData.company.city"/>
          </t>
          <t t-if="props.data.headerData.company.phone">
            <div>Tel: <t t-esc="props.data.headerData.company.phone"/></div>
          </t>
        </div>

        <div class="meta">
          <div class="meta-row">
            <span class="meta-lbl">Order</span>
            <span class="meta-val" t-esc="props.data.name"/>
          </div>
          <div class="meta-row">
            <span class="meta-val" t-esc="props.data.date"/>
          </div>
          <t t-if="props.data.cashier">
            <div class="meta-row">
              <span class="meta-lbl">Cashier</span>
              <span class="meta-val" t-esc="props.data.cashier"/>
            </div>
          </t>
        </div>

        <div class="sep">------------------------------------------</div>

        <!-- ===== LINES ===== -->
        <div class="lines">
          <t t-foreach="props.data.orderlines or []" t-as="line" t-key="line_index">

            <!-- Main line - flex layout for horizontal alignment -->
            <div class="row item d-flex justify-content-between align-items-start">
              <div class="left flex-grow-1">
                <span class="name" t-esc="line.productName"/>
                <t t-if="line.qty != '1.00'">
                  <span class="qty"> x<t t-esc="line.qty"/></span>
                </t>
              </div>

              <!-- Use already-formatted price from orderline -->
              <div class="right text-end ms-2" t-esc="line.price"/>
            </div>

            <!-- Subline ONLY when qty > 1 -->
            <t t-if="line.qty != '1.00'">
              <div class="sub">
                <span t-esc="line.qty"/> @ <span t-esc="line.unitPrice"/>
              </div>
            </t>

            <t t-if="line.customerNote">
              <div class="note">NOTE: <t t-esc="line.customerNote"/></div>
            </t>

          </t>
        </div>

        <div class="sep">------------------------------------------</div>

        <!-- ===== TOTALS ===== -->
        <t t-if="!props.basic_receipt">
          <div class="totals">
            <t t-set="taxTotals" t-value="props.data.taxTotals"/>

            <div class="row">
              <div class="left">Subtotal</div>
              <div class="right" t-esc="props.formatCurrency(taxTotals.subtotals?.[0]?.base_amount_currency or 0)"/>
            </div>

            <!-- Taxes -->
            <t t-if="taxTotals and taxTotals.has_tax_groups">
              <t t-foreach="taxTotals.subtotals" t-as="subtotal" t-key="subtotal.name">
                <t t-foreach="subtotal.tax_groups" t-as="tax_group" t-key="tax_group.id">
                  <div class="row">
                    <div class="left" t-esc="tax_group.group_name"/>
                    <div class="right" t-esc="props.formatCurrency(tax_group.tax_amount_currency)"/>
                  </div>
                </t>
              </t>
            </t>

            <div class="sep thin">------------------------------------------</div>

            <div class="row grand">
              <div class="left">TOTAL</div>
              <div class="right" t-esc="props.formatCurrency(taxTotals.order_sign * taxTotals.order_total)"/>
            </div>

            <t t-if="props.data.paymentlines?.length">
              <div class="sep thin">------------------------------------------</div>
              <t t-foreach="props.data.paymentlines" t-as="line" t-key="line_index">
                <div class="row">
                  <div class="left" t-esc="line.name"/>
                  <div class="right" t-esc="props.formatCurrency(line.amount)"/>
                </div>

                <t t-if="line.ticket">
                  <div class="terminal">
                    <pre t-esc="line.ticket"/>
                  </div>
                </t>
              </t>
            </t>

            <t t-if="props.data.change">
              <div class="row">
                <div class="left">Change</div>
                <div class="right" t-esc="props.formatCurrency(props.data.change)"/>
              </div>
            </t>
          </div>

          <t t-if="props.data.footer">
            <div class="footer-text" t-esc="props.data.footer"/>
          </t>

          <div class="footer">
            <div class="thanks">THANK YOU!</div>
          </div>
        </t>

      </div>
    </xpath>

  </t>

</templates>
