<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Product Label Report Paperformat -->
    <!-- Using ZERO margins - all positioning handled in CSS -->
    <record id="paperformat_product_labels" model="report.paperformat">
        <field name="name">Product Labels (5x3cm, 32 per sheet)</field>
        <field name="default" eval="False"/>
        <field name="format">custom</field>
        <field name="page_height">279</field>
        <field name="page_width">216</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">0</field>
        <field name="margin_bottom">0</field>
        <field name="margin_left">0</field>
        <field name="margin_right">0</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">0</field>
        <field name="dpi">96</field>
        <field name="disable_shrinking" eval="True"/>
    </record>

    <!-- Product Label Report Action -->
    <record id="action_report_product_labels" model="ir.actions.report">
        <field name="name">Product Labels</field>
        <field name="model">product.product</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">product_csv_import.report_product_labels</field>
        <field name="report_file">product_csv_import.report_product_labels</field>
        <field name="print_report_name">'Product_Labels'</field>
        <field name="paperformat_id" ref="paperformat_product_labels"/>
        <field name="binding_model_id" ref="product.model_product_product"/>
        <field name="binding_type">report</field>
    </record>

    <!-- QWeb Report Template - Using absolute positioning -->
    <template id="report_product_labels">
        <t t-call="web.html_container">
            <t t-set="products_list" t-value="list(docs)"/>
            <t t-set="total_products" t-value="len(products_list)"/>

            <t t-foreach="range(0, total_products, 32)" t-as="page_start">
                <div class="page" style="
                    width: 216mm;
                    height: 279mm;
                    position: relative;
                    page-break-after: always;
                    font-family: Arial, Helvetica, sans-serif;
                ">
                    <t t-foreach="range(8)" t-as="row">
                        <t t-foreach="range(4)" t-as="col">
                            <t t-set="idx" t-value="page_start + row * 4 + col"/>
                            <t t-if="idx &lt; total_products">
                                <t t-set="product" t-value="products_list[idx]"/>
                                <!--
                                    Position calculation:
                                    Left: 5mm + col * 52mm (50mm label + 2mm gap)
                                    Top: 15mm + row * 32mm (30mm label + 2mm gap)
                                -->
                                <div t-attf-style="
                                    position: absolute;
                                    left: {{ 5 + col * 52 }}mm;
                                    top: {{ 15 + row * 32 }}mm;
                                    width: 50mm;
                                    height: 30mm;
                                    overflow: hidden;
                                    border: 0.5pt dashed #ccc;
                                    box-sizing: border-box;
                                ">
                                    <!-- Product Name - Top 10mm -->
                                    <div style="
                                        width: 50mm;
                                        height: 10mm;
                                        padding: 1mm 2mm;
                                        text-align: left;
                                        overflow: hidden;
                                    ">
                                        <span style="
                                            font-size: 7pt;
                                            font-weight: 900;
                                            text-transform: uppercase;
                                            line-height: 1.1;
                                        "><t t-esc="product.name"/></span>
                                    </div>

                                    <!-- Barcode and Price - Bottom 20mm -->
                                    <div style="
                                        width: 50mm;
                                        height: 20mm;
                                        padding: 1mm;
                                        position: relative;
                                    ">
                                        <!-- Barcode -->
                                        <div style="
                                            display: inline-block;
                                            width: 32mm;
                                            text-align: center;
                                            vertical-align: top;
                                        ">
                                            <t t-if="product.barcode">
                                                <span t-field="product.barcode" t-options="{'widget': 'barcode', 'width': 120, 'height': 35, 'humanreadable': 0}"/>
                                                <div style="font-size: 6pt; font-family: monospace; margin-top: 0.5mm;"><t t-esc="product.barcode"/></div>
                                            </t>
                                            <t t-else="">
                                                <div style="font-size: 7pt; color: #333; font-style: italic; padding-top: 4mm;">NO BARCODE</div>
                                            </t>
                                        </div>

                                        <!-- Price - moved up 5mm more and slightly right -->
                                        <div style="
                                            position: absolute;
                                            bottom: 10mm;
                                            right: 8mm;
                                            text-align: right;
                                        ">
                                            <span style="font-size: 16pt; font-weight: 900;">
                                                <span style="font-size: 10pt;">$</span><t t-esc="int(product.list_price)"/><span style="font-size: 10pt; vertical-align: top; position: relative; top: -2pt;"><t t-esc="'%02d' % int(round((product.list_price % 1) * 100))"/></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </t>
                    </t>
                </div>
            </t>
        </t>
    </template>
</odoo>

